<% if params[:success] %>
  <p class="flash notice">Paiement rÃ©ussi, merci ! ğŸ‰</p>
<% elsif params[:canceled] %>
  <p class="flash alert">Paiement annulÃ©.</p>
<% end %>

<%= link_to "â¬…ï¸ Retour Ã  la liste des Ã©vÃ©nements",
  root_path(anchor: "events"), 
  class: "btn btn-info" %>

  <h1 class="mb-3"><%= @event.title %></h1>

    <div class="container">
      <p><strong>OrganisÃ© par :</strong> <%= @event.user.first_name %> <%= @event.user.last_name %></p>
      <p><strong>Description :</strong> <%= @event.description %></p>
      <p><strong>Date :</strong> <%= l(@event.start_date, format: :long) %></p>
      <p><strong>DurÃ©e :</strong> <%= @event.duration %> minutes</p>
      <p><strong>Lieu :</strong> <%= @event.location %></p>
      <p><strong>Prix :</strong> <%= @event.price %> â‚¬</p>

  <hr>

  <% if @event.image.attached? %>
    <%= image_tag url_for(@event.image.variant(resize_to_limit: [300, 300])), class: "img-thumbnail" %>
  <% else %>
    <p>Aucune image disponible</p>
  <% end %>

  <% if @event.participants.any? %>
    <p><strong>Nombre de participants :</strong> <%= @event.participants.count %></p>
  <% else %>
    <p>Aucun participant pour le moment.</p>
  <% end %>

  <% if user_signed_in? %>
    <% if current_user.id == @event.user_id %>
      <!-- Organisateur -->
      <div class="d-flex gap-2">
        <%= link_to "ğŸ§™â€â™‚ï¸ AccÃ©der Ã  la liste des participants", participants_event_path(@event), class: "btn btn-info" %>
        <%= link_to "ğŸ“  Modifier l'Ã©vÃ©nement", edit_event_path(@event), class: "btn btn-warning me-2" %>
        <%= button_to "ğŸ—‘ï¸ Supprimer l'Ã©vÃ©nement", event_path(@event), method: :delete,
            data: { turbo: false, confirm: "Tu es sÃ»r(e) de vouloir supprimer cet Ã©vÃ©nement ?" },
            class: "btn btn-danger" %>
      </div>

    <% else %>
      <!-- Utilisateur connectÃ©, pas organisateur -->
      <% if @event.participants.include?(current_user) %>
        <p class="text-success fw-bold">Tu es dÃ©jÃ  inscrit Ã  cet Ã©vÃ©nement ğŸ‰</p>
      <% else %>
        <% if @event.free? %>
          <%= button_to "Sâ€™inscrire gratuitement", checkout_event_path(@event), method: :post, data: { turbo: false }, class: "btn btn-success mt-2" %>
        <% else %>
          <%= button_to "Paiement pour valider votre inscription", checkout_event_path(@event), method: :post, data: { turbo: false }, class: "btn btn-success mt-2" %>
        <% end %>
      <% end %>
    <% end %>

  <% else %>
    <!-- Utilisateur non connectÃ© -->
    <p class="text-muted">Connecte-toi pour tâ€™inscrire Ã  cet Ã©vÃ©nement.</p>
    <%= link_to "Connexion", new_user_session_path, class: "btn btn-outline-primary" %>
  <% end %>
</div>

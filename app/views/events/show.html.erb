<% if params[:success] %>
  <p class="flash notice">Paiement rÃ©ussi, merci ! ğŸ‰</p>
<% elsif params[:canceled] %>
  <p class="flash alert">Paiement annulÃ©.</p>
<% end %>

<div class="container">
  <h1 class="mb-3"><%= @event.title %></h1>
  <p><strong>OrganisÃ© par :</strong> <%= @event.user.first_name %> <%= @event.user.last_name %></p>

  <p><strong>Description :</strong> <%= @event.description %></p>
  <p><strong>Date :</strong> <%= l(@event.start_date, format: :long) %></p>
  <p><strong>DurÃ©e :</strong> <%= @event.duration %> minutes</p>
  <p><strong>Lieu :</strong> <%= @event.location %></p>
  <p><strong>Prix :</strong> <%= @event.price %> â‚¬</p>

  <hr>

  <% if @event.image.attached? %>
    <%= image_tag url_for(@event.image.variant(resize_to_limit: [300, 300])), class: "img-thumbnail" %>
  <% else %>
    <p>Aucune image disponible</p>
  <% end %>

  <% if @event.participants.any? %>
    <p><strong>Nombre de participants :</strong> <%= @event.participants.count %></p>
  <% else %>
    <p>Aucun participant pour le moment.</p>
  <% end %>

  <% if user_signed_in? %>
    <% if current_user.id == @event.user_id %>
      <!-- Organisateur : liste des participants et boutons -->
      <h5>Liste des participants :</h5>
      <ul>
        <% @event.participants.each do |participant| %>
          <li><%= participant.first_name %> <%= participant.last_name %> - <%= participant.email %></li>
        <% end %>
      </ul>

    <div class="d-flex">
      <%= link_to "Modifier l'Ã©vÃ©nement", edit_event_path(@event), class: "btn btn-warning me-2" %>
      <%= button_to "Supprimer l'Ã©vÃ©nement", event_path(@event), method: :delete,
            data: { turbo: false, confirm: "Tu es sÃ»r(e) de vouloir supprimer cet Ã©vÃ©nement ?" },
            class: "btn btn-danger" %>
    </div>
    <% else %>
      <!-- Utilisateur connectÃ©, pas organisateur -->
      <% if @event.participants.include?(current_user) %>
        <p class="text-success fw-bold">Tu es dÃ©jÃ  inscrit Ã  cet Ã©vÃ©nement ğŸ‰</p>
      <% else %>
        <%= button_to "Payer cet Ã©vÃ©nement", checkout_event_path(@event), method: :post, data: { turbo: false }, class: "btn btn-success mt-2" %>
      <% end %>
    <% end %>
  <% else %>
    <!-- Utilisateur non connectÃ© -->
    <p class="text-muted">Connecte-toi pour tâ€™inscrire Ã  cet Ã©vÃ©nement.</p>
    <%= link_to "Connexion", new_user_session_path, class: "btn btn-outline-primary" %>
  <% end %>
</div>
